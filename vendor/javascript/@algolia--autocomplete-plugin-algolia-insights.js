import{debounce as e,safelyRunOnBrowser as t,createRef as r,isEqual as n,noop as o}from"@algolia/autocomplete-shared";function createClickedEvent(e){var t=e.item,r=e.items,n=r===void 0?[]:r;return{index:t.__autocomplete_indexName,items:[t],positions:[1+n.findIndex((function(e){return e.objectID===t.objectID}))],queryID:t.__autocomplete_queryID,algoliaSource:["autocomplete"]}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray$2(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$2(e,t){if(e){if(typeof e==="string")return _arrayLikeToArray$2(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);r==="Object"&&e.constructor&&(r=e.constructor.name);return r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$2(e,t):void 0}}function _arrayLikeToArray$2(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,c=[],s=!0,l=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=i.call(r)).done)&&(c.push(n.value),c.length!==t);s=!0);}catch(e){l=!0,o=e}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function isModernInsightsClient(e){var t=(e.version||"").split(".").map(Number),r=_slicedToArray(t,2),n=r[0],o=r[1];
/* eslint-disable @typescript-eslint/camelcase */var i=n>=3;var a=n===2&&o>=4;var c=n===1&&o>=10;return i||a||c;
/* eslint-enable @typescript-eslint/camelcase */}var i=["items"],a=["items"];function _typeof$1(e){return _typeof$1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$1(e)}function _toConsumableArray$1(e){return _arrayWithoutHoles$1(e)||_iterableToArray$1(e)||_unsupportedIterableToArray$1(e)||_nonIterableSpread$1()}function _nonIterableSpread$1(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$1(e,t){if(e){if(typeof e==="string")return _arrayLikeToArray$1(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);r==="Object"&&e.constructor&&(r=e.constructor.name);return r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$1(e,t):void 0}}function _iterableToArray$1(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function _arrayWithoutHoles$1(e){if(Array.isArray(e))return _arrayLikeToArray$1(e)}function _arrayLikeToArray$1(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _objectWithoutProperties(e,t){if(e==null)return{};var r=_objectWithoutPropertiesLoose(e,t);var n,o;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++){n=i[o];t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}}return r}function _objectWithoutPropertiesLoose(e,t){if(e==null)return{};var r={};var n=Object.keys(e);var o,i;for(i=0;i<n.length;i++){o=n[i];t.indexOf(o)>=0||(r[o]=e[o])}return r}function ownKeys$1(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$1(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$1(Object(r),!0).forEach((function(t){_defineProperty$1(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$1(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _defineProperty$1(e,t,r){t=_toPropertyKey$1(t);t in e?Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true}):e[t]=r;return e}function _toPropertyKey$1(e){var t=_toPrimitive$1(e,"string");return _typeof$1(t)==="symbol"?t:String(t)}function _toPrimitive$1(e,t){if(_typeof$1(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(_typeof$1(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function chunk(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:20;var r=[];for(var n=0;n<e.objectIDs.length;n+=t)r.push(_objectSpread$1(_objectSpread$1({},e),{},{objectIDs:e.objectIDs.slice(n,n+t)}));return r}function mapToInsightsParamsApi(e){return e.map((function(e){var t=e.items,r=_objectWithoutProperties(e,i);return _objectSpread$1(_objectSpread$1({},r),{},{objectIDs:(t===null||t===void 0?void 0:t.map((function(e){var t=e.objectID;return t})))||r.objectIDs})}))}function createSearchInsightsApi(e){var t=isModernInsightsClient(e);function sendToInsights(r,n,o){if(t&&typeof o!=="undefined"){var i=o[0].__autocomplete_algoliaCredentials,a=i.appId,c=i.apiKey;var s={"X-Algolia-Application-Id":a,"X-Algolia-API-Key":c};e.apply(void 0,[r].concat(_toConsumableArray$1(n),[{headers:s}]))}else e.apply(void 0,[r].concat(_toConsumableArray$1(n)))}return{init:function init(t,r){e("init",{appId:t,apiKey:r})},setAuthenticatedUserToken:function setAuthenticatedUserToken(t){e("setAuthenticatedUserToken",t)},setUserToken:function setUserToken(t){e("setUserToken",t)},clickedObjectIDsAfterSearch:function clickedObjectIDsAfterSearch(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.length>0&&sendToInsights("clickedObjectIDsAfterSearch",mapToInsightsParamsApi(t),t[0].items)},clickedObjectIDs:function clickedObjectIDs(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.length>0&&sendToInsights("clickedObjectIDs",mapToInsightsParamsApi(t),t[0].items)},clickedFilters:function clickedFilters(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];r.length>0&&e.apply(void 0,["clickedFilters"].concat(r))},convertedObjectIDsAfterSearch:function convertedObjectIDsAfterSearch(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.length>0&&sendToInsights("convertedObjectIDsAfterSearch",mapToInsightsParamsApi(t),t[0].items)},convertedObjectIDs:function convertedObjectIDs(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.length>0&&sendToInsights("convertedObjectIDs",mapToInsightsParamsApi(t),t[0].items)},convertedFilters:function convertedFilters(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];r.length>0&&e.apply(void 0,["convertedFilters"].concat(r))},viewedObjectIDs:function viewedObjectIDs(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.length>0&&t.reduce((function(e,t){var r=t.items,n=_objectWithoutProperties(t,a);return[].concat(_toConsumableArray$1(e),_toConsumableArray$1(chunk(_objectSpread$1(_objectSpread$1({},n),{},{objectIDs:(r===null||r===void 0?void 0:r.map((function(e){var t=e.objectID;return t})))||n.objectIDs})).map((function(e){return{items:r,payload:e}}))))}),[]).forEach((function(e){var t=e.items,r=e.payload;return sendToInsights("viewedObjectIDs",[r],t)}))},viewedFilters:function viewedFilters(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];r.length>0&&e.apply(void 0,["viewedFilters"].concat(r))}}}function createViewedEvents(e){var t=e.items;var r=t.reduce((function(e,t){var r;e[t.__autocomplete_indexName]=((r=e[t.__autocomplete_indexName])!==null&&r!==void 0?r:[]).concat(t);return e}),{});return Object.keys(r).map((function(e){var t=r[e];return{index:e,items:t,algoliaSource:["autocomplete"]}}))}function isAlgoliaInsightsHit(e){return e.objectID&&e.__autocomplete_indexName&&e.__autocomplete_queryID}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if(typeof e==="string")return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);r==="Object"&&e.constructor&&(r=e.constructor.name);return r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _defineProperty(e,t,r){t=_toPropertyKey(t);t in e?Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true}):e[t]=r;return e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return _typeof(t)==="symbol"?t:String(t)}function _toPrimitive(e,t){if(_typeof(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(_typeof(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var c=400;var s="2.13.0";var l="https://cdn.jsdelivr.net/npm/search-insights@".concat(s,"/dist/search-insights.min.js");var u=e((function(e){var t=e.onItemsChange,r=e.items,n=e.insights,o=e.state;t({insights:n,insightsEvents:createViewedEvents({items:r}).map((function(e){return _objectSpread({eventName:"Items Viewed"},e)})),state:o})}),c);function createAlgoliaInsightsPlugin(o){var i=getOptions(o),a=i.insightsClient,c=i.insightsInitParams,l=i.onItemsChange,f=i.onSelect,p=i.onActive,y=i.__autocomplete_clickAnalytics;var b=a;a||t((function(e){var t=e.window;var r=t.AlgoliaAnalyticsObject||"aa";typeof r==="string"&&(b=t[r]);if(!b){t.AlgoliaAnalyticsObject=r;t[r]||(t[r]=function(){t[r].queue||(t[r].queue=[]);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];t[r].queue.push(n)});t[r].version=s;b=t[r];loadInsights(t)}}));if(!b)return{};c&&b("init",_objectSpread({partial:true},c));var m=createSearchInsightsApi(b);var g=r([]);var d=e((function(e){var t=e.state;if(t.isOpen){var r=t.collections.reduce((function(e,t){return[].concat(_toConsumableArray(e),_toConsumableArray(t.items))}),[]).filter(isAlgoliaInsightsHit);if(!n(g.current.map((function(e){return e.objectID})),r.map((function(e){return e.objectID})))){g.current=r;r.length>0&&u({onItemsChange:l,items:r,insights:m,state:t})}}}),0);return{name:"aa.algoliaInsightsPlugin",subscribe:function subscribe(e){var t=e.setContext,r=e.onSelect,n=e.onActive;var o=false;function setInsightsContext(e){t({algoliaInsightsPlugin:{__algoliaSearchParameters:_objectSpread(_objectSpread({},y?{clickAnalytics:true}:{}),e?{userToken:normalizeUserToken(e)}:{}),insights:m}})}b("addAlgoliaAgent","insights-plugin");setInsightsContext();b("onUserTokenChange",(function(e){o||setInsightsContext(e)}));b("getUserToken",null,(function(e,t){o||setInsightsContext(t)}));b("onAuthenticatedUserTokenChange",(function(e){if(e){o=true;setInsightsContext(e)}else{o=false;b("getUserToken",null,(function(e,t){return setInsightsContext(t)}))}}));b("getAuthenticatedUserToken",null,(function(e,t){if(t){o=true;setInsightsContext(t)}}));r((function(e){var t=e.item,r=e.state,n=e.event,o=e.source;isAlgoliaInsightsHit(t)&&f({state:r,event:n,insights:m,item:t,insightsEvents:[_objectSpread({eventName:"Item Selected"},createClickedEvent({item:t,items:o.getItems().filter(isAlgoliaInsightsHit)}))]})}));n((function(e){var t=e.item,r=e.source,n=e.state,o=e.event;isAlgoliaInsightsHit(t)&&p({state:n,event:o,insights:m,item:t,insightsEvents:[_objectSpread({eventName:"Item Active"},createClickedEvent({item:t,items:r.getItems().filter(isAlgoliaInsightsHit)}))]})}))},onStateChange:function onStateChange(e){var t=e.state;d({state:t})},__autocomplete_pluginOptions:o}}function getAlgoliaSources(){var e;var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];var r=arguments.length>1?arguments[1]:void 0;return[].concat(_toConsumableArray(t),["autocomplete-internal"],_toConsumableArray((e=r.algoliaInsightsPlugin)!==null&&e!==void 0&&e.__automaticInsights?["autocomplete-automatic"]:[]))}function getOptions(e){return _objectSpread({onItemsChange:function onItemsChange(e){var t=e.insights,r=e.insightsEvents,n=e.state;t.viewedObjectIDs.apply(t,_toConsumableArray(r.map((function(e){return _objectSpread(_objectSpread({},e),{},{algoliaSource:getAlgoliaSources(e.algoliaSource,n.context)})}))))},onSelect:function onSelect(e){var t=e.insights,r=e.insightsEvents,n=e.state;t.clickedObjectIDsAfterSearch.apply(t,_toConsumableArray(r.map((function(e){return _objectSpread(_objectSpread({},e),{},{algoliaSource:getAlgoliaSources(e.algoliaSource,n.context)})}))))},onActive:o,__autocomplete_clickAnalytics:true},e)}function loadInsights(e){var t="[Autocomplete]: Could not load search-insights.js. Please load it manually following https://alg.li/insights-autocomplete";try{var r=e.document.createElement("script");r.async=true;r.src=l;r.onerror=function(){console.error(t)};document.body.appendChild(r)}catch(e){console.error(t)}}function normalizeUserToken(e){return typeof e==="number"?e.toString():e}export{createAlgoliaInsightsPlugin};

